# LightTavern 用户使用说明

本指南面向日常使用者，介绍如何登录、创建角色、开始聊天、调整模型以及管理员操作。

## 1. 登录系统

1. 打开首页 `/`。
2. 输入管理员分配的邮箱和密码。
3. 点击“进入系统”。

说明：
- 本系统不提供前台自助注册。
- 如果提示“账号不可用”，请联系管理员检查账号状态。

## 2. 角色管理（Dashboard）

入口：`/dashboard`

你可以在这里：
- 查看角色列表
- 添加新角色
- 编辑角色
- 删除角色（软删除）
- 进入某个角色聊天

### 2.1 添加角色

1. 点击“添加角色”。
2. 至少填写“角色名称”。
3. 建议同时填写：人设（Persona）、问候语（Greeting）、场景（Scenario）、风格（Style）、规则（Rules）。
4. 可上传角色封面图。
5. 保存后返回角色列表。

### 2.2 编辑角色

1. 在角色卡片点击“编辑”。
2. 修改内容后保存。
3. 聊天页会使用最新角色设定。

### 2.3 删除角色

1. 在角色卡片点击“删除”。
2. 删除后角色不再显示在列表中。

说明：删除为软删除，仅对当前用户生效。

## 3. 开始聊天

入口：`/character/[角色ID]`（通常从 Dashboard 点击“进入聊天”）

聊天页行为：
- 首次进入会自动初始化会话。
- 如果角色设置了问候语，会自动显示为首条助手消息。
- 发送消息后，助手会流式输出回复。
- 助手消息下方可能显示 token 用量：`↑ prompt`、`↓ completion`、`Σ total`。

### 3.1 发送消息

1. 在输入框输入内容。
2. 按 Enter 发送（Shift + Enter 换行）。
3. 等待模型生成回复。

### 3.2 清空会话

点击“清空”后：
- 历史消息会被清空。
- 如果角色有问候语，会重新写入问候语。

### 3.3 聊天设置

聊天页可打开“聊天设置”，常见项：
- `maxHistory`：发送给模型的历史消息条数上限。
- `includeExamples`：是否包含角色示例对话。

建议：
- 回复跑题时，降低历史条数试试。
- 需要角色语气更稳定时，打开 `includeExamples`。

## 4. 模型设置

入口：`/settings`

你可以：
- 拉取可用模型列表
- 选择默认模型
- 保存模型偏好
- 测试模型连通性

推荐流程：
1. 点击“拉取模型”。
2. 选择目标模型。
3. 点击“测试连接”。
4. 连接成功后点击“保存”。

## 5. 管理员功能

入口：`/admin`（仅管理员可见）

管理员可执行：
- 创建用户
- 查看用户列表与详情
- 禁用/启用用户

### 5.1 创建用户

1. 进入管理后台。
2. 输入邮箱与密码（密码至少 8 位）。
3. 提交后用户即可登录。

### 5.2 禁用/启用用户

- 禁用后用户无法登录或继续访问受保护页面。
- 启用后用户可恢复访问。
- 当前管理员不能禁用自己。

## 6. 常见问题

### Q1：登录失败怎么办？
- 检查邮箱和密码是否正确。
- 联系管理员确认账号未被禁用或删除。

### Q2：模型拉取失败/连接失败怎么办？
- 先检查网络。
- 再联系管理员检查 OpenRouter API Key 配置。

### Q3：角色封面上传失败怎么办？
- 可能是存储桶权限或配置问题。
- 联系管理员检查 Supabase Storage bucket 配置。

### Q4：为什么看不到管理后台？
- 只有 `admin` 角色可访问 `/admin`。

## 7. 最佳实践

- 角色卡至少写清楚：人设、规则、问候语。
- 每个角色使用独立会话，便于保持上下文一致。
- 模型切换后先做一轮“测试连接”。
- 对话质量下降时，先清空会话再继续。
